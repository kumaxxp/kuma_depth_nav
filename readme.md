# Kuma Depth Nav

リアルタイムカメラの深度推定とストリーミングを行うFastAPIベースのウェブアプリケーションです。

## 機能

- ウェブブラウザを通じたリアルタイムカメラのストリーミング
- Depth Anythingモデルを使用したリアルタイム深度推定
- 通常のカメラビュー、深度マップ、深度グリッドの3種類の表示モード
- パフォーマンス統計情報のリアルタイム表示（FPSと遅延時間）

## ディレクトリ構成

```
kuma_depth_nav/
├── config.json                # アプリケーション設定ファイル
├── requirements.txt           # 依存パッケージリスト
├── simple_fastapi_camera.py   # メインアプリケーションファイル
├── utils.py                   # ユーティリティ関数
└── depth_processor/           # 深度処理モジュール
    ├── __init__.py            # モジュール初期化
    ├── depth_model.py         # 深度推定モデルの実装
    ├── point_cloud.py         # 点群処理用ユーティリティ
    └── visualization.py       # 深度マップの可視化関数
```

## 必要条件

- Python 3.8以上
- OpenCV
- FastAPI
- Uvicorn
- NumPy
- その他 requirements.txt に記載されている依存パッケージ

## インストール方法

1. このリポジトリをクローンまたはダウンロードします。

2. 必要なパッケージをインストールします：

```bash
pip install -r requirements.txt
```

## 実行方法

以下のコマンドでアプリケーションを起動します：

```bash
python simple_fastapi_camera.py
```

アプリケーションが起動したら、ブラウザで以下のURLにアクセスします：

```
http://localhost:8888
```

## インターフェース説明

Webインターフェースには以下の3つのビューがあります：

1. **Camera Stream** - 通常のカメラ映像
2. **Depth Map** - 深度推定のヒートマップ表示
3. **Depth Grid** - 深度をグリッド形式で表示

また、パフォーマンス統計情報（FPSと遅延時間）も表示されます。

## パフォーマンス最適化

アプリケーションは以下の点で最適化されています：

- マルチスレッド処理でカメラキャプチャと深度推定を並行実行
- 効率的なメモリ管理
- 低レイテンシのための最適化されたストリーミング
- エラー時の自動カメラリセット機能

## 注意点

- カメラが正しく接続されていることを確認してください
- 十分なCPU/GPU性能がないと、推論速度が低下する可能性があります
